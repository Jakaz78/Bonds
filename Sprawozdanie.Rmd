---
title: "Sprawozdanie"
author: "Jakub Kaźmierczyk"
date: "2025-05-29"
output: pdf_document
---

# Wprowadzenie

## Opis projektu

cos tam cos tam

## Zmienna objaśniana

Close - zmienna objasniana bedzie rentownosc 10-letnich polskich obligacji skarbowcyh

## Zmienne objaśniające

XAUUSD - cena złota w dolarze amerykańskim\
S&P500 - ETF 500 największych notowanych na giełdzie amerykańskich spółek\
PMI - cos tam\
WIG20 - 20 najwiekszych notowanych na gieldzie polskich spolek\
OIL - cena ropy naftowej za barylke\
UNEMPLOYMENT - stopa bezrobocia w Polsce\
USDPLN - kurs dolara amerykańskiego wyrażony w złotych\
INFLATION - inflacja r/r wobec miesiąca odpowiadającego z roku temu\

## Źródła

[www.stooq.com](https://stooq.pl)\

```{r setup, include=FALSE}
library(corrplot)
library(readxl)
library(tinytex)
library(ggcorrplot)
library(urca)      
library(tseries)   
library(ggplot2)   
library(dplyr)     
library(tidyr)
library(zoo)


```

# Wczytywanie danych

```{r}

data_numeric <- read_excel("data2.xlsx")

data_numeric <- data_numeric[, c("Close", "Inflation",  "XAUUSD", 
                          "USDPLN",  
                          "WIG20", "S&P500", "UNEMPLOYMENT", "PMI", "OIL")]

Y <- data_numeric["Close"]
X <- data_numeric[,c("Inflation","XAUUSD", "USDPLN","WIG20","S&P500","UNEMPLOYMENT","PMI","OIL")]

data_numeric <- data_numeric[sapply(data_numeric, is.numeric)]




data_numeric_interp <- data_numeric


numeric_cols <- sapply(data_numeric_interp, is.numeric)

data_numeric_interp[numeric_cols] <- lapply(data_numeric_interp[numeric_cols], function(col) {
  na.approx(col, na.rm = FALSE)
})



```

# Podstawowe statystyki

## Zmienna objaśniana

```{r}
summary(Y)
```

## Zmienne objaśniające

```{r}
summary(X)

```

# Zaleznosci miedzy Y a X

```{r}

```

# Macierz korelacji

```{r corrplot, fig.width=20, fig.height=20}
cor_matrix <- cor(data_numeric, use = "pairwise.complete.obs", method = "pearson")


    corrplot(cor_matrix, method = "color",
           order = "hclust",
           addCoef.col = "black", 
           tl.col = "black", tl.cex = 2.5, cl.cex = 2.5, number.cex=2.6)
```

## Test

```{r analiza_stacjonarnosci, warning=FALSE, message=FALSE, fig.height=5, fig.width=7, fig.align='center'}

library(ggplot2)
library(dplyr)
library(tseries)
library(urca)

# Funkcja do testu ADF
adf_result <- function(series, name) {
  test <- ur.df(series, type = "trend", selectlags = "AIC")
  #cat("Test ADF dla zmiennej:", name, "\n")
  #print(summary(test))
  #cat("\n\n")
}

# Funkcja do testu KPSS
kpss_result <- function(series, name) {
  #cat("Test KPSS dla zmiennej:", name, "\n")
  #print(kpss.test(series))
  #cat("\n\n")
}

# Funkcja do wykresów
plot_series_diff <- function(series, name) {
  df <- data.frame(
    Time = 1:length(series),
    Series = as.numeric(series),
    Diff = c(NA, diff(series))
  )

  p1 <- ggplot(df, aes(x = Time, y = Series)) +
    geom_line(color = "blue") +
    labs(title = paste("Szereg czasowy:", name), y = name)

  p2 <- ggplot(df, aes(x = Time, y = Diff)) +
    geom_line(color = "red") +
    labs(title = paste("Pierwsza różnica:", name), y = paste("delta", name))

  list(p1, p2)
}

# Funkcja pomocnicza do sprawdzenia stacjonarności
is_non_stationary <- function(series) {
  adf <- ur.df(series, type = "trend", selectlags = "AIC")
  adf_stat <- adf@teststat[1]
  adf_crit <- adf@cval[1, "5pct"]
  adf_stationary <- (adf_stat < adf_crit)

  kpss <- kpss.test(series)
  kpss_stationary <- (kpss$p.value > 0.05)

  # Jeśli przynajmniej jeden test mówi, że nie jest stacjonarna → uznaj za niestacjonarną
  return(!(adf_stationary & kpss_stationary))
}

# Inicjalizacja pustego wektora
non_stationary_vars <- c()

# Analiza zmiennych
for (var in colnames(X)) {
  cat("## Zmienna:", var, "\n\n")
  series <- ts(data_numeric[[var]])

  # Testy
  if (is_non_stationary(series)) {
    non_stationary_vars <- c(non_stationary_vars, var)
  }

  # Wykresy
  plots <- plot_series_diff(series, var)
  print(plots[[1]])
  print(plots[[2]])

  # Szczegóły testów
  adf_result(series, var)
  kpss_result(series, var)
}

cat("Zidentyfikowane zmienne niestacjonarne:\n")
print(non_stationary_vars)

